### Copying docker images
https://stackoverflow.com/questions/23935141/how-to-copy-docker-images-from-one-host-to-another-without-via-repository

### Installing Docker on Windows
# ERROR: Hardware assisted virtualization and data execution protection must be enabled in the BIOS. See https://docs.docker.com/docker-for-windows/troubleshoot/#virtualization-must-be-enabled
# https://stackoverflow.com/questions/39684974/docker-for-windows-error-hardware-assisted-virtualization-and-data-execution-p

### Getting OMT
git clone https://github.com/klokantech/openmaptiles.git klokantech-openmaptiles
cd klokantech-openmaptiles
git checkout japan

### Download Albania
docker-compose run --rm import-osm  ./download-geofabrik.sh albania
# ERROR: Cannot create container for service import-osm: D: drive is not shared. Please share it in Docker for Windows Settings
# https://blogs.msdn.microsoft.com/stevelasker/2016/06/14/configuring-docker-for-windows-volumes/

### Prepare import configuration
docker-compose run --rm openmaptiles-tools make clean
docker-compose run --rm openmaptiles-tools make

### Start DB
docker-compose up   -d postgres

### Import data
docker-compose run --rm import-water
docker-compose run --rm import-osmborder
docker-compose run --rm import-natural-earth
docker-compose run --rm import-lakelines
docker-compose run --rm import-osm
docker-compose run --rm import-sql

### Connect to DB
docker-compose run --rm postgres psql postgresql://openmaptiles@postgres/openmaptiles

### Analyze (reporting), vacuum analyze (lower DB size)
docker-compose run --rm import-osm /usr/src/app/psql.sh  -P pager=off  -c "ANALYZE VERBOSE;"
docker-compose run --rm import-osm /usr/src/app/psql.sh  -P pager=off  -c "VACUUM ANALYZE VERBOSE;"

### Render tiles
docker-compose -f docker-compose.yml -f ./data/docker-compose-config.yml  run --rm generate-vectortiles

### Add metadata
docker-compose run --rm openmaptiles-tools  generate-metadata ./data/tiles.mbtiles
docker-compose run --rm openmaptiles-tools  chmod 666         ./data/tiles.mbtiles

### Serve MBTiles
docker run -it --rm -v $(pwd)/data:/data -p 8080:80 klokantech/tileserver-gl
docker run -it --rm -v %cd%/data:/data -p 8080:80 klokantech/tileserver-gl

### Render Hokkaido
rm -rf data
cp -r sample-data/ data
wget -O data/hokkaido-latest.osm.pbf http://download.geofabrik.de/asia/japan/hokkaido-latest.osm.pbf
docker-compose run --rm openmaptiles-tools make clean
docker-compose run --rm openmaptiles-tools make
docker-compose run --rm import-osm
docker-compose run --rm import-sql
docker-compose -f docker-compose.yml -f ./data/docker-compose-config.yml  run --rm generate-vectortiles
docker-compose run --rm openmaptiles-tools  generate-metadata ./data/tiles.mbtiles
docker-compose run --rm openmaptiles-tools  chmod 666         ./data/tiles.mbtiles
docker run -it --rm -v $(pwd)/data:/data -p 8080:80 klokantech/tileserver-gl

### Install Maputnik (style editor)
# https://github.com/maputnik/editor/releases
maputnik_windows.exe

### Download map style
cd ..
git clone https://github.com/openmaptiles/osm-bright-gl-style
cd klokantech-openmaptiles

### Edit style locally
docker run -it --rm -v $$(pwd)/data:/data -p 8080:80 klokantech/tileserver-gl
docker run -it --rm -v %cd%/data:/data -p 8080:80 klokantech/tileserver-gl
maputnik_windows.exe --watch --file ..\osm-bright-gl-style\style.json
